# AIクイズアプリ 要件定義書

## 1. プロジェクト概要

### 1.1. 目的

このアプリは、AIが出題する様々なゲームを通じて、複数のユーザーがリアルタイムで楽しみを共有できるWebアプリケーションを提供することを目的とする。

### 1.2. コンセプト

- AI (Spring AI + Vertex AI Gemini) がリアルタイムでゲームコンテンツ（クイズ、なぞなぞ等）を生成する。

- 複数ユーザーが同じ画面を共有し、グループでイベントとして楽しめる。

### 1.3. ペルソナ

- メイン: 学校、会社、サークルなどの集まりで、手軽に盛り上がれるシンプルなゲームを探しているグループ。

- サブ: IT（プログラミングなど）の勉強会で、手軽に知識を確認したいIT初心者や学習者のグループ。

- サブ: 一人でシンプルなクイズやなぞなぞをプレイしたいユーザー。

## 2. 機能要件

ここでは、ユーザーが体験する機能（ユーザーストーリー）を詳細化し、具体的な仕様を定義する。

### 2.1. ゲーム選択機能

- ユーザーストーリー: ユーザーがプレイしたいゲームを選択する。
- 仕様:
    - アプリケーションの初期画面として「ゲーム選択画面」を表示する。
    - 選択可能なゲームの一覧をボタン形式で表示する。
        - クイズゲーム (今回実装)
        - なぞなぞゲーム (将来実装)
        - ウミガメのスープ (将来実装)
    - 「クイズゲーム」を選択すると、「プレイヤー登録画面」に遷移する。
    - 実装されていないゲームのボタンは「準備中」と表示し、選択不可とする。

### 2.2. プレイヤー管理機能

- ユーザーストーリー: ユーザーがプレイヤー名登録する。

- 仕様:

    - 「プレイヤー登録画面」にて、プレイヤー名を1〜16人まで登録できる。

        - 登録はクイズ開始前に全員分まとめて行う。

        - クイズプレイ中、プレイヤーを追加で登録することも可能。その場合、既存のプレイヤー情報やスコアは維持される。

        - 登録されたプレイヤー情報（スコア、名前、アイコン）は、画面下部に常に表示される。（例: [+][-] 0 👤田中）

    - プレイヤーごとに識別用の色（自動割り当て）と、選択可能なシンプルなアイコン（任意）を設定できる。

### 2.3. クイズ設定機能

- ユーザーストーリー: クイズのジャンル、難易度、ゲームモード、問題数を選択する。

- 仕様:

    - 「ゲーム設定画面」にて、以下のジャンルからクイズのテーマを単一選択できる。

        - 一般: 歴史, 化学, 地理, 映画, アニメ

        - IT系: プログラミングの概念, Java, C#, Python, SQL

        - その他: ランダム (全ジャンルから)

    - 「ゲーム設定画面」にて、以下の難易度を選択できる。

        - かんたん, ふつう, むずかしい

    - 「ゲーム設定画面」にて、後述する「2.6. ゲームモード機能」からモードを選択できる。

    - **問題数設定**: 「ゲーム設定画面」にて、以下の問題数から選択できる。
        - 15問、30問、45問、無制限
        - 無制限を選択した場合、クイズは手動で停止されるまで継続する。

    - 選択された設定は、バックエンド（Spring AI）がAIへクイズ生成を指示する際のプロンプト（指示文）に利用される。

### 2.4. クイズプレイ機能

- ユーザーストーリー: AIからクイズ（4択）が出題され、ヒントも貰え、回答できる。

- 仕様:

    - 「出題」ボタンを押すと、バックエンド（Spring AI）がAI APIを呼び出し、設定に基づいたクイズ（問題文、4択の選択肢、正解の選択肢、解説）を生成する。

    - 画面には問題文と4つの選択肢（A, B, C, Dなど）を表示する。

    - 「ヒント」ボタン押下時、バックエンドはAIに対し、その問題に関連する追加のヒント（関連キーワードや、答えを補足する簡単な説明文）を要求し、表示する。

    - ユーザーが選択肢を選び「回答」ボタンを押すと、AIが生成した「正解の選択肢」と照合し、**自動で正誤判定（正解/不正解）**を行う。

    - 回答後、画面は「正解の選択肢」およびAIが生成した「解説」を表示する。

    - **問題カウンター**: クイズプレイ画面上部に「X / Y 問目」（例: 12 / 15 問目）のように現在の問題番号と全問題数を表示する。無制限の場合は表示しない。

    - **クイズ終了判定と結果画面への遷移**: 設定された問題数をすべて出題し終えた場合、クイズの新規出題は行わず、モーダルダイアログを表示して「結果を見る」ボタンを促す。このボタンを押すと、「2.8. クイズリザルト画面」へ遷移する。

    - （補足）AIによる自動判定は表示するが、最終的なスコア加算（2.5参照）はモードによって異なる。

        - クイズの重複を防ぐため、バックエンドは出題した全ての問題をジャンル情報と共にデータベースに記録する。

        - 「出題」ボタン押下時、バックエンドは現在選択中のジャンルにおける最新30件の出題履歴をデータベースから取得し、AIへの指示に含めることで、直近の同ジャンルの問題と重複しないクイズの生成を促す。

### 2.5. スコア管理機能

- ユーザーストーリー: プレイヤーの正答数を管理する。

- 仕様:

    - **全員回答モード**: 正解発表後、各プレイヤーは画面下部の自分の名前の横にある [+] ボタンを押してスコアを手動で加算する。（[-] ボタンで減点も可能）

    - **ターン制モード**: 正解時、現在の回答者のスコアが自動で+1点加算される。手動でのスコア操作はできない。

    - (MVPスコープ): スコア、プレイヤー情報は永続化されない。

    - スコア等のデータはすべてフロントエンド（Angular）のメモリ上でのみ保持され、ページをリロード（再読み込み）するとリセットされる。クイズの出題履歴のみがデータベースに永続化される。

### 2.6. ゲームモード機能

- ユーザーストーリー: プレイヤー全員で回答するか、順番に回答するかを選択できる。

- 仕様:

    - ゲーム開始前に、以下の2つのモードから1つを選択する。

    - **2.6.1. 全員回答モード**

        - 全員が回答者となり、クイズに参加する。

        - スコアは「2.5. スコア管理機能」に基づき、手動で加算する。

        - これまでのバージョンと同様の挙動とする。

    - **2.6.2. ターン制モード (デフォルト)**

        - 登録されたプレイヤーが、順番に一人ずつ回答者となる。

        - ターン順はプレイヤーの登録順とする。

        - クイズプレイ画面には「次は [プレイヤー名] さんの番です」のように、現在のターン対象者を大きく表示する。

        - 画面下部のプレイヤースコアエリアでは、現在の回答者のプレイヤーアイコンや背景色を強調表示する。

        - 正解した場合、その回答者のスコアが自動で+1点加算される。

        - 回答後（正解・不正解問わず）、「次の問題へ」ボタンを押すと次のプレイヤーにターンが移る。最後のプレイヤーの番が終わると、最初のプレイヤーに戻る。

### 2.7. バージョン・更新履歴表示機能
- ユーザーストーリー: ユーザーがアプリのバージョンと更新履歴を確認できる。
- 仕様:
    - 「ゲーム選択画面」の左上にアプリケーションのバージョン番号（例: Ver. 1.1.0）を表示する。
    - 「ゲーム選択画面」の右上に「更新履歴」リンクを表示する。
    - 「更新履歴」リンクをクリックすると、モーダルウィンドウが開き、過去の変更履歴一覧を表示する。
    - バージョン番号と更新履歴の内容は、フロントエンドのコード内に静的に保持し、データベースからの取得は行わない。

### 2.8. クイズリザルト画面 (New)
- ユーザーストーリー: クイズ終了後、プレイヤーの最終結果と順位を確認する。
- 仕様:
    - クイズが終了した後、「クイズプレイ画面」のモーダルから「結果を見る」ボタンを押すことで遷移する。
    - 各プレイヤーの得点と、それに基づいたランキング（例: 1位、2位…）を表示する。
    - 以下のナビゲーションボタンを配置する。
        - 「設定に戻る」: クイズ設定画面に遷移し、プレイヤー情報は維持されるが、クイズのジャンルや難易度はリセットされる。
        - 「ゲームをリセット」: プレイヤー登録画面に遷移し、すべてのプレイヤー情報とスコアがリセットされる。
        - 「ユーザーを追加する」: プレイヤー登録画面に遷移し、現在のプレイヤー情報とスコアを維持したまま、新しいユーザーを追加できる。

## 3. 非機能要件

### 3.1. パフォーマンス

- AI（Gemini API）へのリクエスト（クイズ生成、ヒント生成、正誤判定/解説）が、7秒以内に完了し、画面に反映されることを目標とする。

- 待機中は、ローディング中であることが分かるUI（ローディングスピナーなど）を表示する。

- 個人開発のMVPであるため、コスト（API利用料）を優先する。上記の目標時間を超える場合も、コスト最適化の範囲内であれば許容する。

### 3.2. データ管理/永続性

- 本アプリでは、出題されたクイズの情報（問題文、選択肢、正解、解説、ジャンル、難易度など）をデータベースに保存し、永続化する。これにより、セッションやユーザーを跨いで問題の重複を防止する。

- プレイヤー情報、スコア、バージョン番号、更新履歴については、永続化（データベース保存）は行わない。これらのデータはフロントエンド（Angular）のメモリ上やコード内に静的に管理され、プレイヤー情報とスコアはブラウザをリロードまたは閉じると消失する（セッション限り）。

### 3.3. セキュリティ

- (MVPスコープ): ユーザーアカウント登録やログイン機能はなく、個人情報や機密データを扱わないため、セキュリティ要件は特になしとする。

### 3.4. 可用性

- (MVPスコープ): 個人開発のMVPであり、永続化データもないため、可用性に関する特別な要件は特になしとする。（ベストエフォート）

## 4. 開発スコープ

### 4.1. MVP (今回開発する範囲)

- ゲーム選択機能
- プレイヤー登録機能（1〜16人、色・アイコン選択、メモリ保持のみ）
- クイズ設定機能（ジャンル、難易度選択、**問題数設定**）
- **ゲームモード選択機能（全員回答モード、ターン制モード）**
- AIによるクイズ出題機能（4択、解説生成）
- AIによるヒント生成機能
- **スコア管理機能（手動加算および自動加算）**
- **データベース連携によるクイズ履歴の永続化**
- **クイズ進行状況カウンター表示**
- **クイズ終了モーダル表示**
- **クイズリザルト画面表示**

### 4.2. MVP対象外 (将来的な拡張)

- なぞなぞゲーム、ウミガメのスープ等の別ゲームモード
- 過去問の復習機能
- ユーザーアカウント登録（ログイン）機能
- 複数ブラウザ（PC、スマホ）間でのリアルタイムな状態同期

## 5. 使用スタック (MVP)

- バックエンド： Spring Boot (Spring AI)
    - AI（Vertex AI Gemini API）との連携、クイズ生成ロジックの実行
- フロントエンド： Angular
    - UIの描画、プレイヤー情報とスコアの（一時的な）状態管理
- AI： Vertex AI Gemini API
- データベース： H2 Database (開発用), PostgreSQL (本番用)
    - クイズの出題履歴を永続化するために使用する。
- 開発環境： Rocky 9（WSL2）