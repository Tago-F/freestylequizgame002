# AIクイズアプリ タスク計画書

## 1. 概要

このドキュメントは、「AIクイズアプリ」のMVP（Minimum Viable Product）開発におけるタスクリストと計画を定義する。
各タスクには、作業内容、難易度、優先度を割り振る。

- **難易度**:
    - **高**: 複雑なロジック、新しい技術の導入、または広範囲な影響を伴うタスク
    - **中**: 標準的な実装だが、複数のコンポーネントやロジックが絡むタスク
    - **低**: 単純な設定、定型的な実装、または軽微な修正で完了するタスク

- **優先度**:
    - **高**: このタスクが完了しないと他の多くのタスクがブロックされる、またはコア機能に必須
    - **中**: 重要だが、他のタスクと並行して進められる、または代替手段が存在する
    - **低**: コア機能ではない、または後回しにしても影響が少ない改善タスク

---

## 2. タスク一覧

### カテゴリ1: プロジェクト基盤構築 (Setup)

| ID | タスク内容 | 難易度 | 優先度 | タスク状態 | 備考 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| S-01 | Spring Boot プロジェクトの初期設定 | 低 | 高 | 完了 | Spring Initializr を使用。Java, Spring Web, Spring AI (Vertex AI) の依存関係を追加。 |
| S-02 | Angular プロジェクトの初期設定 | 低 | 高 | 完了 | Angular CLI を使用。`ng new` でプロジェクトを作成。 |
| S-03 | プロジェクト構造の決定 | 低 | 高 | 完了 | バックエンドとフロントエンドのディレクトリ構成を決定する。(例: `backend/`, `frontend/`) |
| S-04 | CORS設定 (Spring Boot) | 低 | 高 | 完了 | AngularからのAPIリクエストを許可するための設定。 |

### カテゴリ2: バックエンド開発 (Spring Boot)

| ID | タスク内容 | 難易度 | 優先度 | タスク状態 | 備考 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| BE-01 | APIデータモデル(DTO)の実装 | 低 | 高 | 完了 | `GenerateQuizRequest`, `QuizResponse`, `HintRequest`, `HintResponse`, `ErrorResponse` のJavaクラスを作成。 |
| BE-02 | クイズ生成API (`/quiz/generate`) のコントローラー実装 | 中 | 高 | 完了 | `POST /api/v1/quiz/generate` のエンドポイントを作成。リクエストを受け取り、サービスクラスを呼び出す。 |
| BE-03 | AI連携サービスクラスの実装 (クイズ生成) | 高 | 高 | 完了 | Spring AI を使用して Vertex AI Gemini API と連携。プロンプトを組み立て、クイズを生成させる。 |
| BE-04 | ヒント生成API (`/quiz/hint`) のコントローラー実装 | 中 | 高 | 完了 | `POST /api/v1/quiz/hint` のエンドポイントを作成。 |
| BE-05 | AI連携サービスクラスの実装 (ヒント生成) | 高 | 高 | 完了 | クイズ情報に基づき、Gemini API にヒント生成を指示する。 |
| BE-06 | グローバル例外ハンドラーの実装 | 中 | 中 | 完了 | APIエラー時に `ErrorResponse` 形式で統一されたエラーを返すための設定。 |
| BE-07 | プロンプトテンプレートの作成 | 中 | 高 | 完了 | クイズ生成・ヒント生成のためのプロンプトを `prompt.txt` などの外部ファイルで管理する。 |
| BE-08 | APIの単体テスト/結合テスト | 中 | 中 | キャンセル済み | JUnit, Mockito, MockMvc などを使用して、APIが仕様通りに動作することを確認する。 |

### カテゴリ3: フロントエンド開発 (Angular)

| ID | タスク内容 | 難易度 | 優先度 | タスク状態 | 備考 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| FE-01 | 画面遷移のルーティング設定 | 低 | 高 | 完了 | `app-routing.module.ts` に3画面のパスを設定。 |
| FE-02 | プレイヤー登録画面コンポーネントの実装 | 中 | 高 | 完了 | プレイヤーの動的な追加・削除機能、入力フォームの実装。 |
| FE-03 | クイズ設定画面コンポーネントの実装 | 低 | 高 | 完了 | ジャンルと難易度の選択UIを作成。 |
| FE-04 | クイズプレイ画面コンポーネントの実装 | 高 | 高 | 完了 | ヘッダー、クイズエリア、スコアエリアの3つの主要エリアを持つレイアウトを構築。 |
| FE-05 | 状態管理サービスの作成 (プレイヤー/スコア) | 中 | 高 | 完了 | プレイヤーリストと各スコアを管理するサービスを作成 (例: `PlayerStateService`)。 |
| FE-06 | 状態管理サービスの作成 (クイズ) | 中 | 高 | 完了 | 現在のクイズ情報、ゲーム設定（ジャンル、難易度）を管理するサービスを作成 (例: `QuizStateService`)。 |
| FE-07 | API通信サービスの作成 | 中 | 高 | 完了 | Spring Boot API を呼び出すための `HttpClient` を使用したサービスを作成 (例: `ApiService`)。 |
| FE-08 | クイズプレイ画面のロジック実装 (状態遷移) | 高 | 高 | 完了 | 「ローディング中」「回答受付中」「解説表示」の状態に応じて表示を切り替えるロジックを実装。 |
| FE-09 | ローディングスピナーコンポーネントの実装 | 低 | 中 | 完了 | API通信中などに表示する共通コンポーネント。 |
| FE-10 | UI/UXのスタイリング | 中 | 中 | 完了 | CSSフレームワーク（例: Angular Material, Bootstrap）を導入し、ワイヤーフレームに基づき画面をデザイン。 |
| FE-11 | 確認ダイアログの実装 | 低 | 中 | 実施未確認 | 「ゲームをリセット」ボタン押下時に表示する確認モーダル。 |
| FE-19 | クイズプレイ画面に「設定に戻る」リンクを追加 | 低 | 中 | 実施未確認 | プレイヤーの状態を維持したまま、クイズ設定画面に戻る機能。 |

### カテゴリ4: 統合・テスト (Integration & Testing)

| ID | タスク内容 | 難易度 | 優先度 | タスク状態 | 備考 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| IT-01 | フロントエンドとバックエンドの統合テスト | 中 | 高 | 保留 | 実際に画面を操作し、API連携が正しく行われるかを確認する。 |
| IT-02 | E2E (End-to-End) テストシナリオの作成と実施 | 高 | 低 | 保留 | プレイヤー登録からクイズ回答までの一連の流れを自動テストする。(MVPでは手動でも可) |
| IT-03 | クロスブラウザテスト | 低 | 低 | 保留 | 主要なブラウザ（Chrome, Firefoxなど）でレイアウト崩れや動作不良がないか確認。 |

### カテゴリ5: ゲーム選択機能追加

| ID | タスク内容 | 難易度 | 優先度 | タスク状態 | 備考 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| GS-01 | ゲーム選択画面コンポーネントの作成 | 低 | 高 | 完了 | `ng generate component game-selection` でコンポーネントの雛形を作成する。 |
| GS-02 | ゲーム選択画面のUI実装 | 低 | 高 | 完了 | 画面設計書に基づき、HTMLとCSSでゲーム選択ボタンを配置する。 |
| GS-03 | ルーティング設定の変更 | 中 | 高 | 完了 | アプリケーションの初期ルート (`/`) をゲーム選択画面に変更し、クイズゲームのフロー (`/player-setup` など) へ遷移できるようにする。 |
| GS-04 | プレイヤー登録画面の修正 | 低 | 中 | 実施未確認 | ゲーム選択画面に戻るための「戻る」ボタンを追加する。 |

### カテゴリ6: DBによる永続的重複防止機能

| ID | タスク内容 | 難易度 | 優先度 | タスク状態 | 備考 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| DOC-01| 関連ドキュメントの更新 | 低 | 高 | 完了 | 新仕様（ジャンル別・最新15件）に合わせて要件定義書、タスク計画書を更新する。|
| DB-01 | Spring BootへのDB依存関係追加 | 低 | 高 | 実施済み | `pom.xml` に `spring-boot-starter-data-jpa` と PostgreSQLドライバを追加する。 |
| DB-02 | DB接続設定 | 低 | 高 | 完了 | `application.properties` にDB接続設定を追加する。 |
| DB-03 | `AskedQuestion` エンティティの拡張 | 中 | 高 | 実施未確認 | `question`カラムに加え、`genre`カラムとソート用の`createdAt`タイムスタンプカラムを追加する。 |
| DB-04 | `AskedQuestionRepository` の改修 | 中 | 高 | 変更予定 | 指定されたジャンルの最新15件の問題文を、出題日が新しい順に取得するカスタムクエリを実装する。 |
| BE-09 | `QuizService` のロジック修正 | 高 | 高 | 変更予定 | 起動時に指定ジャンルの過去問最新15件を取得し、クイズ生成後はジャンルも合わせてDBに保存するようロジック変更。 |
| FE-20 | フロントエンド状態管理の簡略化 | 中 | 高 | 実施未確認 | `quiz-state.service.ts` から `quizHistory` Signal と関連ロジックを削除する。 |
| FE-21 | フロントエンドAPIモデルの修正 | 低 | 高 | 実施未確認 | `quiz.model.ts` の `GenerateQuizRequest` から `previousQuestions` プロパティを削除する。 |

### カテゴリ7: ターン制モード追加

| ID | タスク内容 | 難易度 | 優先度 | タスク状態 | 備考 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| FE-12 | 状態管理の拡張 (ゲームモード) | 中 | 高 | 完了 | `QuizStateService` に、現在のゲームモード (`全員回答` or `ターン制`)、現在の回答者インデックスを保持する状態を追加する。 |
| FE-13 | ゲーム設定画面: モード選択UIの実装 | 低 | 高 | 実施未確認 | `game-setup.component` に、ゲームモードを選択するためのラジオボタンUIを追加し、`QuizStateService` の状態を更新するロジックを実装する。 |
| FE-14 | クイズプレイ画面: ターン表示UIの実装 | 中 | 高 | 完了 | `quiz-play.component` に、ターン制モードの場合のみ「次は〇〇さんの番です」という表示を行うUIとロジックを追加する。 |
| FE-15 | プレイヤースコアエリア: 回答者強調表示 | 中 | 高 | 実施未確認 | プレイヤースコア表示コンポーネントにて、ターン制モードの場合、現在の回答者の表示をCSSで強調するロジックを追加する。 |
| FE-16 | クイズプレイ画面: スコア自動加算ロジック | 中 | 高 | 完了 | `quiz-play.component` で正解が判定された際、現在のモードが「ターン制」であれば `PlayerStateService` を呼び出してスコアを+1するアクションを実行する。 |
| FE-17 | 状態管理の拡張 (ターン進行) | 中 | 高 | 実施未確認 | `QuizStateService` に、次のプレイヤーへターンを移すアクションを定義する。`quiz-play.component` の「次の問題へ」ボタン押下時にこのアクションを呼び出す。 |
| FE-18 | スコアエリア: ボタン表示切り替え | 低 | 中 | 完了 | プレイヤースコア表示コンポーネントにて、ゲームモードに応じてスコアの `[+] [-]` ボタンの表示/非表示を切り替える。 |

### カテゴリ8: バージョン情報・更新履歴表示

| ID | タスク内容 | 難易度 | 優先度 | タスク状態 | 備考 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| DOC-02| 関連ドキュメントの更新 | 低 | 高 | 完了 | 要件定義書、画面設計書、タスク計画書、変更履歴.mdにバージョン・更新履歴機能の仕様を追記する。 |
| FE-22 | バージョン・更新履歴データモデルの作成 | 低 | 高 | 完了 | `frontend` 側にバージョン番号と更新履歴の静的データを保持するモデル(または定数)を定義する。 |
| FE-23 | ゲーム選択画面への表示実装 | 低 | 高 | 完了 | ゲーム選択画面のHTMLを修正し、左上にバージョン番号、右上に「更新履歴」リンクを表示する。 |
| FE-24 | 更新履歴モーダルコンポーネントの実装 | 中 | 高 | 完了 | 更新履歴を表示するためのモーダルUIコンポーネントを作成する。(Angular MaterialのDialogなどを利用) |
| FE-25 | モーダル表示ロジックの実装 | 低 | 高 | 完了 | 「更新履歴」リンクのクリックイベントをトリガーに、モーダルコンポーネントを表示するロジックを実装する。 |

---

## 3. 改善タスク一覧 (MVPリリース後)

(現在は空)

